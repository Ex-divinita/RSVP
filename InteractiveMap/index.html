<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tirana International Fair - Exhibitor Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use a nice, modern font like Inter */
        body { 
            background-color: #f0f2f5; 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        /* Ensure Inter font is loaded (optional, but good practice) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        .active-floor { 
            background-color: #1d4ed8 !important; 
            color: white !important; 
            border-color: #1d4ed8 !important; 
        }
        .booth-shape {
            stroke-width: 1.5; 
            cursor: pointer; 
            transition: all 0.2s ease-in-out;
            /* A slightly more subtle shadow */
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        }
        .booth-shape:hover { 
            transform: translateY(-1px); 
            filter: drop-shadow(4px 4px 3px rgba(0, 0, 0, 0.3)); 
        }
        .booth-unassigned { 
            cursor: default; 
        }
        .booth-unassigned:hover { 
            transform: none; 
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2)); 
        }
        .booth-highlight { 
            stroke-width: 4 !important; 
            stroke: #facc15 !important; 
            /* Add a glow effect to the highlight */
            filter: drop-shadow(0px 0px 8px rgba(250, 204, 21, 0.9));
        }
        
        #legend-container {
            @apply absolute bottom-4 right-4 bg-white bg-opacity-90 p-3 rounded-lg shadow-lg border border-gray-200 z-20;
        }
        .legend-item { @apply flex items-center gap-2 mb-1 text-sm; }
        .legend-color-box { @apply w-4 h-4 rounded border border-gray-400; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white shadow-md p-4 flex flex-wrap justify-between items-center gap-4">
        <div>
            <!-- Added a logo placeholder -->
            <h1 class="text-2xl font-bold text-gray-800">Tirana International Fair</h1>
            <h2 class="text-md text-gray-600">Interactive Exhibitor Map</h2>
            <div class="mt-2">
                <input type="text" id="searchInput" placeholder="Search Exhibitors..." class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
        <!-- Floor switcher buttons -->
        <div class="flex gap-2">
            <button data-floor="-1" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">-1</button>
            <button data-floor="0" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">0</button>
            <button data-floor="1" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">1</button>
            <button data-floor="2" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">2</button>
        </div>
    </header>

    <!-- Main Map Area -->
    <main class="flex-grow container mx-auto p-4 flex justify-center items-center">
        <!-- Map container holds the background and SVG overlay -->
        <div id="map-container" class="relative w-full max-w-6xl bg-white shadow-lg rounded-lg border border-gray-200 aspect-[3/2] overflow-hidden">
            <img id="floor-plan-bg" src="" alt="Floor Plan" class="absolute top-0 left-0 w-full h-full object-cover">
            <svg id="booth-overlay" class="absolute top-0 left-0 w-full h-full" viewBox="0 0 1200 800" preserveAspectRatio="none"></svg>
            
            <!-- Legend Container -->
            <div id="legend-container">
                <h4 class="font-bold text-sm mb-2">Sectors</h4>
                <div id="legend-items"></div>
            </div>
        </div>
    </main>
    
    <!-- Exhibitor Details Modal -->
    <div id="detailsModal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm relative transform transition-all duration-300 scale-95">
            <!-- Modal Close Button -->
            <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <div class="p-6 text-center">
                <img id="modal-logo" src="" alt="Exhibitor Logo" class="w-24 h-24 object-contain rounded-md mx-auto mb-4 border border-gray-200 p-1 bg-gray-50" onerror="this.src='https://placehold.co/100x100/cccccc/969696?text=No+Logo'; this.onerror=null;">
                <h3 id="modal-name" class="text-2xl font-bold text-gray-800 mb-1"></h3>
                <p id="modal-sector" class="text-md text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Global Configuration ---
        const sectorColors = {
            'Unassigned':   { color: 'rgba(156, 163, 175, 0.5)', stroke: '#6b7280'},
            'Energy':       { color: 'rgba(250, 204, 21, 0.5)', stroke: '#d97706'},
            'Manufacturing':{ color: 'rgba(59, 130, 246, 0.5)', stroke: '#1d4ed8'},
            'Construction': { color: 'rgba(249, 115, 22, 0.5)', stroke: '#c2410c'},
            'Technology':   { color: 'rgba(16, 185, 129, 0.5)', stroke: '#047857'},
            'Automotive':   { color: 'rgba(239, 68, 68, 0.5)',  stroke: '#b91c1c'},
            'Finance':      { color: 'rgba(139, 92, 246, 0.5)', stroke: '#6d28d9'},
        };

        // --- DOM Element References ---
        const floorPlanBg = document.getElementById('floor-plan-bg');
        const boothOverlay = document.getElementById('booth-overlay');
        const floorSwitchers = document.querySelectorAll('.floor-switcher');
        const searchInput = document.getElementById('searchInput');
        const detailsModal = document.getElementById('detailsModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalLogo = document.getElementById('modal-logo');
        const modalName = document.getElementById('modal-name');
        const modalSector = document.getElementById('modal-sector');
        const legendItems = document.getElementById('legend-items');
        const mapContainer = document.getElementById('map-container'); // **ADDED**

        // --- Application State ---
        let appData = null; 
        let activeFloor = 0;

        // --- Embedded Data ---
        // **ADDED**: This data is now embedded to avoid fetch errors and use your local images.
        const EMBEDDED_DATA = {
            "activeFloor": 0,
            "floors": {
                "-1": {
                    "backgroundURL": "./floor-1.jpg",
                    "objects": [
                        { "points": [{ "x": 100, "y": 600 }, { "x": 300, "y": 600 }, { "x": 300, "y": 750 }, { "x": 100, "y": 750 }], "exhibitorName": "Basement Storage", "sector": "Unassigned", "logoUrl": "" },
                        { "points": [{ "x": 350, "y": 600 }, { "x": 550, "y": 600 }, { "x": 550, "y": 750 }, { "x": 350, "y": 750 }], "exhibitorName": "Utilities", "sector": "Unassigned", "logoUrl": "" }
                    ]
                },
                "0": {
                    "backgroundURL": "./floor0.jpg",
                    "objects": [
                        { "points": [{ "x": 50, "y": 50 }, { "x": 250, "y": 50 }, { "x": 250, "y": 200 }, { "x": 50, "y": 200 }], "exhibitorName": "Energy Solutions Ltd.", "sector": "Energy", "logoUrl": "https://placehold.co/100x100/facc15/451a0e?text=Energy" },
                        { "points": [{ "x": 270, "y": 50 }, { "x": 470, "y": 50 }, { "x": 470, "y": 200 }, { "x": 270, "y": 200 }], "exhibitorName": "Future Tech Inc.", "sector": "Technology", "logoUrl": "https://placehold.co/100x100/10b981/04433b?text=Tech" },
                        { "points": [{ "x": 50, "y": 220 }, { "x": 150, "y": 220 }, { "x": 150, "y": 320 }, { "x": 50, "y": 320 }], "exhibitorName": "Unnamed Booth", "sector": "Unassigned", "logoUrl": "" },
                        { "points": [{ "x": 170, "y": 220 }, { "x": 270, "y": 220 }, { "x": 270, "y": 320 }, { "x": 170, "y": 320 }], "exhibitorName": "Unnamed Booth", "sector": "Unassigned", "logoUrl": "" },
                        { "points": [{ "x": 700, "y": 400 }, { "x": 900, "y": 400 }, { "x": 900, "y": 550 }, { "x": 700, "y": 550 }], "exhibitorName": "Global Motors", "sector": "Automotive", "logoUrl": "https://placehold.co/100x100/ef4444/7f1d1d?text=Auto" }
                    ]
                },
                "1": {
                    "backgroundURL": "./floor1.jpg",
                    "objects": [
                        { "points": [{ "x": 100, "y": 100 }, { "x": 400, "y": 100 }, { "x": 400, "y": 300 }, { "x": 100, "y": 300 }], "exhibitorName": "BuildRight Corp.", "sector": "Construction", "logoUrl": "https://placehold.co/100x100/f97316/7c2d12?text=Build" },
                        { "points": [{ "x": 100, "y": 320 }, { "x": 400, "y": 320 }, { "x": 400, "y": 520 }, { "x": 100, "y": 520 }], "exhibitorName": "SecureBank", "sector": "Finance", "logoUrl": "https://placehold.co/100x100/8b5cf6/4c1d95?text=Bank" },
                        { "points": [{ "x": 420, "y": 100 }, { "x": 620, "y": 100 }, { "x": 620, "y": 200 }, { "x": 420, "y": 200 }], "exhibitorName": "Unnamed Booth", "sector": "Unassigned", "logoUrl": "" }
                    ]
                },
                "2": {
                    "backgroundURL": "./floor2.jpg",
                    "objects": [
                        { "points": [{ "x": 50, "y": 50 }, { "x": 350, "y": 50 }, { "x": 350, "y": 250 }, { "x": 50, "y": 250 }], "exhibitorName": "SteelWorks Ltd.", "sector": "Manufacturing", "logoUrl": "https://placehold.co/100x100/3b82f6/1e3a8a?text=Steel" }
                    ]
                }
            }
        };

        const loadData = () => { // **MODIFIED**: Removed async
            try {
                // **MODIFIED**: Removed fetch, use embedded data
                appData = EMBEDDED_DATA;
                if (!appData) throw new Error('Embedded data is missing or invalid.');
                switchFloor(appData.activeFloor || 0);
            } catch (error) { 
                // **MODIFIED**: Replaced alert() with a console error and visual message
                console.error(error.message);
                mapContainer.innerHTML = `<div class="flex items-center justify-center h-full text-red-600 font-bold p-10 text-center">Error: Could not load map data. ${error.message}</div>`;
            }
        };

        const renderFloor = (floorNumber) => {
            if (!appData) return;
            const floorData = appData.floors[floorNumber];
            if (!floorData) {
                // **ADDED**: Handle missing floor data gracefully
                console.warn(`No data found for floor: ${floorNumber}`);
                floorPlanBg.src = 'https://placehold.co/1200x800/f87171/7f1d1d?text=Error:+Floor+Not+Found';
                boothOverlay.innerHTML = '';
                return;
            }

            floorPlanBg.src = floorData.backgroundURL;
            boothOverlay.innerHTML = ''; 

            floorData.objects.forEach(obj => {
                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const pointsString = obj.points.map(p => `${p.x},${p.y}`).join(' ');
                polygon.setAttribute('points', pointsString);
                
                const sector = obj.sector || 'Unassigned';
                const colors = sectorColors[sector] || sectorColors['Unassigned'];
                polygon.style.fill = colors.color;
                polygon.style.stroke = colors.stroke;

                // Store data on the element
                polygon.dataset.name = obj.exhibitorName;
                polygon.dataset.logo = obj.logoUrl;
                polygon.dataset.sector = obj.sector;
                
                polygon.classList.add('booth-shape');
                if (sector === 'Unassigned' || obj.exhibitorName === 'Unnamed Booth') {
                    polygon.classList.add('booth-unassigned');
                } else {
                     // Add click event only if it's an assigned booth
                    polygon.addEventListener('click', () => showModal(polygon.dataset));
                }
                boothOverlay.appendChild(polygon);
            });
            handleSearch(); // Apply search filter to new floor
        };
        
        const renderLegend = () => {
            legendItems.innerHTML = '';
            for(const sector in sectorColors) {
                // **ADDED**: Don't show "Unassigned" in the legend
                if (sector === 'Unassigned') continue;

                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `<div class="legend-color-box" style="background-color: ${sectorColors[sector].color}; border-color: ${sectorColors[sector].stroke};"></div><span>${sector}</span>`; // **MODIFIED**: Added border color
                legendItems.appendChild(item);
            }
        };

        // --- UI Handlers ---
        const handleSearch = () => {
            const query = searchInput.value.toLowerCase().trim();
            boothOverlay.querySelectorAll('polygon.booth-shape').forEach(poly => {
                const name = (poly.dataset.name || '').toLowerCase();
                // Highlight if query exists and name includes it
                poly.classList.toggle('booth-highlight', query && name.includes(query));
            });
        };

        const switchFloor = (floorNumber) => {
            activeFloor = floorNumber;
            floorSwitchers.forEach(btn => {
                btn.classList.toggle('active-floor', parseInt(btn.dataset.floor, 10) === floorNumber);
            });
            searchInput.value = ''; // Clear search on floor switch
            renderFloor(activeFloor);
        };

        const showModal = (data) => {
            modalName.textContent = data.name;
            modalSector.textContent = data.sector || 'N/A';
            modalLogo.src = data.logo || 'https://placehold.co/100x100/cccccc/969696?text=No+Logo';
            
            // Modal transition
            detailsModal.classList.remove('hidden');
            setTimeout(() => {
                detailsModal.querySelector('.transform').classList.remove('scale-95');
            }, 10); // Short delay to allow CSS transition
        };

        const hideModal = () => {
            detailsModal.querySelector('.transform').classList.add('scale-95');
            setTimeout(() => {
                detailsModal.classList.add('hidden');
            }, 300); // Match transition duration
        };

        // --- Event Listeners ---
        floorSwitchers.forEach(btn => btn.addEventListener('click', () => switchFloor(parseInt(btn.dataset.floor, 10))));
        searchInput.addEventListener('input', handleSearch);
        closeModalBtn.addEventListener('click', hideModal);
        detailsModal.addEventListener('click', (e) => { 
            // Close if clicking on the background overlay
            if (e.target === detailsModal) hideModal(); 
        });

        // --- Initial Load ---
        renderLegend();
        loadData();
    });
    </script>
</body>
</html>

