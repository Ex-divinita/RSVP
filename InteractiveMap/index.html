<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tirana International Fair - Exhibitor Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .active-floor { background-color: #1d4ed8 !important; color: white !important; border-color: #1d4ed8 !important; }
        .booth-shape {
            stroke-width: 1.5; cursor: pointer; transition: all 0.2s ease-in-out;
            filter: drop-shadow(3px 3px 2px rgba(0, 0, 0, 0.3));
        }
        .booth-shape:hover { transform: translateY(-2px); filter: drop-shadow(5px 5px 4px rgba(0, 0, 0, 0.4)); }
        .booth-unassigned { cursor: default; }
        .booth-unassigned:hover { transform: none; filter: drop-shadow(3px 3px 2px rgba(0, 0, 0, 0.3)); }
        .booth-highlight { stroke-width: 4 !important; stroke: #facc15 !important; }
        /* **MODIFIED**: Styles for the legend to be on the right */
        #legend-container {
            @apply absolute bottom-4 right-4 bg-white bg-opacity-90 p-3 rounded-lg shadow-lg border border-gray-200 z-20;
        }
        .legend-item { @apply flex items-center gap-2 mb-1; }
        .legend-color-box { @apply w-4 h-4 rounded border border-gray-400; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white shadow-md p-4 flex flex-wrap justify-between items-center gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Tirana International Fair</h1>
            <h2 class="text-md text-gray-600">Interactive Exhibitor Map</h2>
            <div class="mt-2">
                <input type="text" id="searchInput" placeholder="Search Exhibitors..." class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
        </div>
        <div class="flex gap-2">
            <button data-floor="-1" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">-1</button>
            <button data-floor="0" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">0</button>
            <button data-floor="1" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">1</button>
            <button data-floor="2" class="floor-switcher w-10 h-10 rounded-full bg-white border-2 border-gray-300 font-bold text-gray-700 flex items-center justify-center shadow-md hover:bg-gray-100 transition-all">2</button>
        </div>
    </header>

    <!-- Main Map Area -->
    <main class="flex-grow container mx-auto p-4 flex justify-center items-center">
        <div id="map-container" class="relative w-full max-w-6xl bg-white shadow-lg rounded-lg border border-gray-200 aspect-[3/2]">
            <img id="floor-plan-bg" src="" alt="Floor Plan" class="absolute top-0 left-0 w-full h-full object-cover">
            <svg id="booth-overlay" class="absolute top-0 left-0 w-full h-full" viewBox="0 0 1200 800" preserveAspectRatio="none"></svg>
             <!-- Legend Container -->
            <div id="legend-container">
                <h4 class="font-bold text-sm mb-2">Sectors</h4>
                <div id="legend-items"></div>
            </div>
        </div>
    </main>
    
    <!-- Exhibitor Details Modal -->
    <div id="detailsModal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm relative">
            <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <div class="p-6 text-center">
                <img id="modal-logo" src="" alt="Exhibitor Logo" class="w-24 h-24 object-contain rounded-md mx-auto mb-4 border border-gray-200 p-1">
                <h3 id="modal-name" class="text-2xl font-bold text-gray-800 mb-1"></h3>
                <p id="modal-sector" class="text-md text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Global Configuration ---
        const sectorColors = {
            'Unassigned':   { color: 'rgba(156, 163, 175, 0.5)', stroke: '#6b7280'},
            'Energy':       { color: 'rgba(250, 204, 21, 0.5)', stroke: '#d97706'},
            'Manufacturing':{ color: 'rgba(59, 130, 246, 0.5)', stroke: '#1d4ed8'},
            'Construction': { color: 'rgba(249, 115, 22, 0.5)', stroke: '#c2410c'},
            'Technology':   { color: 'rgba(16, 185, 129, 0.5)', stroke: '#047857'},
            'Automotive':   { color: 'rgba(239, 68, 68, 0.5)',  stroke: '#b91c1c'},
            'Finance':      { color: 'rgba(139, 92, 246, 0.5)', stroke: '#6d28d9'},
        };

        // --- DOM Element References ---
        const floorPlanBg = document.getElementById('floor-plan-bg');
        const boothOverlay = document.getElementById('booth-overlay');
        const floorSwitchers = document.querySelectorAll('.floor-switcher');
        const searchInput = document.getElementById('searchInput');
        const detailsModal = document.getElementById('detailsModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalLogo = document.getElementById('modal-logo');
        const modalName = document.getElementById('modal-name');
        const modalSector = document.getElementById('modal-sector');
        const legendItems = document.getElementById('legend-items');

        // --- Application State ---
        let appData = null; 
        let activeFloor = 0;

        const loadData = async () => {
            try {
                const response = await fetch('./floor-plan-data.json');
                if (!response.ok) throw new Error('Could not find floor-plan-data.json.');
                appData = await response.json();
                switchFloor(appData.activeFloor || 0);
            } catch (error) { alert(error.message); }
        };

        const renderFloor = (floorNumber) => {
            if (!appData) return;
            const floorData = appData.floors[floorNumber];
            if (!floorData) return;

            floorPlanBg.src = floorData.backgroundURL;
            boothOverlay.innerHTML = ''; 

            floorData.objects.forEach(obj => {
                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const pointsString = obj.points.map(p => `${p.x},${p.y}`).join(' ');
                polygon.setAttribute('points', pointsString);
                
                const sector = obj.sector || 'Unassigned';
                const colors = sectorColors[sector] || sectorColors['Unassigned'];
                polygon.style.fill = colors.color;
                polygon.style.stroke = colors.stroke;

                polygon.dataset.name = obj.exhibitorName;
                polygon.dataset.logo = obj.logoUrl;
                polygon.dataset.sector = obj.sector;
                
                polygon.classList.add('booth-shape');
                if (sector === 'Unassigned' || obj.exhibitorName === 'Unnamed Booth') {
                    polygon.classList.add('booth-unassigned');
                }

                polygon.addEventListener('click', () => {
                    if (polygon.classList.contains('booth-unassigned')) return;
                    modalName.textContent = polygon.dataset.name;
                    modalSector.textContent = polygon.dataset.sector || '';
                    modalLogo.src = polygon.dataset.logo || 'https://placehold.co/100x100/cccccc/969696?text=No+Logo';
                    detailsModal.classList.remove('hidden');
                });
                boothOverlay.appendChild(polygon);
            });
            handleSearch();
        };
        
        const handleSearch = () => {
            const query = searchInput.value.toLowerCase().trim();
            boothOverlay.querySelectorAll('polygon.booth-shape').forEach(poly => {
                const name = (poly.dataset.name || '').toLowerCase();
                poly.classList.toggle('booth-highlight', query && name.includes(query));
            });
        };

        const switchFloor = (floorNumber) => {
            activeFloor = floorNumber;
            floorSwitchers.forEach(btn => {
                btn.classList.toggle('active-floor', parseInt(btn.dataset.floor, 10) === floorNumber);
            });
            searchInput.value = '';
            renderFloor(activeFloor);
        };

        const renderLegend = () => {
            legendItems.innerHTML = '';
            for(const sector in sectorColors) {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `<div class="legend-color-box" style="background-color: ${sectorColors[sector].color};"></div><span>${sector}</span>`;
                legendItems.appendChild(item);
            }
        };

        // --- Event Listeners ---
        floorSwitchers.forEach(btn => btn.addEventListener('click', () => switchFloor(parseInt(btn.dataset.floor, 10))));
        searchInput.addEventListener('input', handleSearch);
        closeModalBtn.addEventListener('click', () => detailsModal.classList.add('hidden'));
        detailsModal.addEventListener('click', (e) => { if (e.target === detailsModal) detailsModal.classList.add('hidden'); });

        // --- Initial Load ---
        renderLegend();
        loadData();
    });
    </script>
</body>
</html>

